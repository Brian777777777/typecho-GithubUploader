# Typecho GitHub Uploader & Gallery Solution

这是一套为 Typecho 定制的轻量级**图床管理与壁纸展示方案**。它由一个**后端插件**和一个**前端模板**组成，实现了从图片上传、CDN 加速到自动归档展示的全流程自动化。

## ✨ 主要功能

* **☁️ GitHub 图床集成**：自动将图片上传至 GitHub 公开仓库。
* **⚡ CDN 加速**：自动生成 `jsDelivr` 全球加速链接。
* **🤖 自动归档**：上传时选择分类，系统会自动将图片链接写入“壁纸展示页”的数据库中，无需手动编辑文章。
* **🛡️ 安全鉴权**：基于 Typecho 原生插件机制，仅管理员可上传，Token 不暴露在前端，无 CORS 跨域风险。
* **🎨 瀑布流展示**：前端页面采用 Masonry 布局 + 懒加载 + Fancybox 灯箱，极致流畅。
* **🔧 零依赖**：不需要修改 Typecho 核心代码，不依赖伪静态配置。

## 📂 目录结构

请确保您的文件目录结构如下：

```text
Typecho根目录/
├── usr/
│   ├── plugins/
│   │   └── GithubUploader/       <-- 后端插件目录
│   │       ├── Plugin.php        # 插件入口与配置
│   │       └── Action.php        # 核心上传与数据库逻辑
│   │
│   └── themes/
│       └── 您的主题名/
│           ├── page_gallery.php  # 前端：壁纸展示页模板
│           └── page_upload.php   # 前端：上传工具页模板
```

## 🚀 安装步骤

### 第一步：部署后端插件

1.  在 `usr/plugins/` 下新建文件夹 `GithubUploader`。
2.  将 `Plugin.php` 和 `Action.php` 放入该文件夹。
3.  进入 Typecho 后台 -> **插件管理**。
4.  启用 **GitHub 图床上传助手** 插件。

### 第二步：部署前端模板

1.  将 `page_gallery.php` 和 `page_upload.php` 上传到您当前使用的**主题目录**中。

## ⚙️ 配置说明

进入 Typecho 后台 -> 插件管理 -> GitHub 图床上传助手 -> **设置**，填入以下信息：

| 配置项 | 说明 | 示例 |
| :--- | :--- | :--- |
| **GitHub 用户名** | 您的 GitHub 账号名 | `Brian` |
| **仓库名** | **必须是 Public (公开) 仓库** | `images` |
| **分支名** | 通常是 `main` 或 `master` | `main` |
| **GitHub Token** | 前往 GitHub Settings -> Developer settings -> PAT 申请，**权限需勾选 `repo`** | `ghp_xxxx...` |
| **存储目录** | 图片在仓库中的存放路径 | `blog` |
| **壁纸页缩略名** | **核心配置！** 必须与下一步创建的壁纸页 Slug 一致 | `gallery` |

## 📝 页面创建 (至关重要)

您需要在后台创建**两个**独立页面。

### 1. 创建“壁纸展示页”
* **标题**：壁纸墙 (自定义)
* **缩略名 (Slug)**：`gallery` (**必须与插件设置中的一致**)
* **自定义模板**：选择 **Gallery Ultimate**
* **内容**：可以留空，或者预设一些分类，格式如下：
    ```text
    # 动漫
    https://example.com/1.jpg

    # 风景
    https://example.com/2.jpg
    ```

### 2. 创建“上传工具页”
* **标题**：上传工具 (自定义)
* **缩略名 (Slug)**：`upload` (任意，建议简单点)
* **自定义模板**：选择 **GitHub Upload Page (UI Only)**
* **发布页面**。

## 🖥️ 使用指南

1.  **访问上传页**：
    * 作为管理员登录。
    * 访问您刚才创建的上传页面（如 `yoursite.com/upload`），或者在“壁纸墙”页面顶部点击 **“上传图片 (Admin)”** 按钮。
2.  **上传图片**：
    * **左侧**：选择已有分类，或者选择“+ 新增分类”并输入新名称。
    * **右侧**：点击上传、拖拽图片，或者直接 **Ctrl + V** 粘贴截图。
3.  **查看结果**：
    * 上传成功后，页面会显示 Markdown 链接。
    * 此时，系统已经自动修改了“壁纸展示页”的数据库，新图片已插入到对应分类的最上方。
4.  **浏览壁纸**：
    * 回到“壁纸墙”页面，刷新即可看到新图片。

## ❓ 常见问题 (FAQ)

**Q: 上传时提示 `Server Error` 或 `404`？**
> **A:** 请确保您使用的是**插件版**方案。旧的单文件方案受服务器伪静态规则影响较大。插件版使用的是 Typecho 官方路由 `/index.php/action/github-upload`，稳定性极高。

**Q: 为什么下拉列表里没有分类？**
> **A:** 请检查插件设置里的 **“壁纸页缩略名”** 是否与您实际创建页面的 Slug 完全一致。

**Q: 分类解析不出来？**
> **A:** 插件已内置 BOM 头清洗功能。请确保您的壁纸页内容格式规范，分类必须以 `# ` (井号+空格) 开头。

**Q: 图片上传了，但是没写入数据库？**
> **A:** 检查您的 GitHub Token 是否过期，或者仓库是否已满（极少见）。同时检查 Typecho 数据库权限是否可写。

## 📜 许可证

Custom Solution for Brian.
Based on Typecho Plugin Architecture.
